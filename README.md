# Environment setup

Create namespaces that will be used

    kubectl create namespace ingress-nginx
    kubectl create namespace backend

# Install nginx-ingress-controller


Configure `nginx-ingress-controller-values.yaml` and install the ingress controller using a helm chart


```bash
helm upgrade --install nginx-ingress-controller oci://registry-1.docker.io/bitnamicharts/nginx-ingress-controller -f nginx-ingress-controller-values.yaml -n ingress-nginx
```

# Create a self-signed certificate

Configure `openssl.cnf` and create a self signed certificate

```bash
openssl req -new -key tls.key -out tls.csr -config openssl.cnf
```

## Save certificate as kubernetes secret

    kubectl create secret tls myservice-cert --cert=tls.crt --key=tls.key

# Install nginx web server as http/https backend

Configure `nginx-values.yaml` file to enable tls, load certificates from existing secret and configure https server block

```yaml
tls:
  enabled: true
  autoGenerated: false
  existingSecret: myservice-cert

service:
  type: ClusterIP

serverBlock: |-
  server {
    listen              8443 ssl;
    server_name         myservice.example.com;

    ssl_certificate     /certs/tls.crt;
    ssl_certificate_key /certs/tls.key;

    location / {
        root /app;
        index index.html;
    }
  }
```

Install nginx using a helm chart and custom `nginx-values.yaml` file

    helm install nginx-backend oci://registry-1.docker.io/bitnamicharts/nginx -f nginx-values.yaml

# Configure ingress

Modify `ingress.yaml` with service name, host, port, certificate secretName and apply

    kubectl apply -f ingress.yaml

